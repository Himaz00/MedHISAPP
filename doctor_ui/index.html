<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Arzt UI</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      margin: 0;
      padding: 20px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      color: #333;
    }
    h1 {
      color: #fff;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
      animation: fadeInDown 1s ease-out;
      margin-bottom: 30px;
    }
    .card {
      border: none;
      padding: 20px;
      border-radius: 12px;
      max-width: 700px;
      width: 100%;
      background: #fff;
      box-shadow: 0 8px 32px rgba(0,0,0,0.1);
      animation: fadeInUp 1s ease-out 0.5s both;
      transition: transform 0.3s ease, box-shadow 0.3s ease;
    }
    .card:hover {
      transform: translateY(-5px);
      box-shadow: 0 12px 40px rgba(0,0,0,0.2);
    }
    .loading {
      display: flex;
      align-items: center;
      justify-content: center;
      animation: spin 1s linear infinite;
    }
    .spinner {
      border: 4px solid #f3f3f3;
      border-top: 4px solid #667eea;
      border-radius: 50%;
      width: 40px;
      height: 40px;
    }
    h2, h3 {
      color: #2b6cb0;
      margin-top: 20px;
    }
    ul {
      list-style-type: none;
      padding: 0;
    }
    li {
      padding: 8px 0;
      border-bottom: 1px solid #eee;
      animation: slideInLeft 0.5s ease-out both;
    }
    li:nth-child(1) { animation-delay: 0.1s; }
    li:nth-child(2) { animation-delay: 0.2s; }
    li:nth-child(3) { animation-delay: 0.3s; }
    li:nth-child(4) { animation-delay: 0.4s; }
    li:nth-child(5) { animation-delay: 0.5s; }
    @keyframes fadeInDown {
      from { opacity: 0; transform: translateY(-30px); }
      to { opacity: 1; transform: translateY(0); }
    }
    @keyframes fadeInUp {
      from { opacity: 0; transform: translateY(30px); }
      to { opacity: 1; transform: translateY(0); }
    }
    @keyframes slideInLeft {
      from { opacity: 0; transform: translateX(-30px); }
      to { opacity: 1; transform: translateX(0); }
    }
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    .patient-btn {
      display: block;
      width: 100%;
      padding: 10px;
      margin: 5px 0;
      background: #667eea;
      color: #fff;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      transition: background 0.3s ease;
    }
    .patient-btn:hover {
      background: #5a67d8;
    }
    .back-btn {
      padding: 10px 20px;
      background: #e53e3e;
      color: #fff;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      margin-top: 20px;
      transition: background 0.3s ease;
    }
    .back-btn:hover {
      background: #c53030;
    }
  </style>
</head>
<body>
  <h1>Arzt UI</h1>
  <div class="card" id="patient-list">
    <div class="loading">
      <div class="spinner"></div>
      <p style="margin-left: 10px;">Lade Patientenliste...</p>
    </div>
  </div>
  <div class="card" id="patient" style="display: none;">
    <div class="loading">
      <div class="spinner"></div>
      <p style="margin-left: 10px;">Lade Patientendaten...</p>
    </div>
  </div>

  <script>
    const API_BASE = 'http://localhost:8000';

    // Function to load patient list: fetches list of patients from the API Gateway and displays them as buttons.
    async function loadPatientList() {
      const listDiv = document.getElementById('patient-list');
      try {
        const res = await fetch(`${API_BASE}/patients`);
        if (!res.ok) {
          listDiv.innerHTML = '<p>Keine Patienten gefunden. Stellen Sie sicher, dass Sie /push-json-data im HIS Adapter gedrückt haben.</p>';
          return;
        }
        const patients = await res.json();
        let html = '<h2>Patientenliste</h2>';
        patients.forEach(p => {
          html += `<button onclick="loadPatient('${p.id}')" class="patient-btn">${p.name} </button>`;
        });
        listDiv.innerHTML = html;
      } catch (e) {
        listDiv.innerHTML = '<p>Fehler beim Laden der Patientenliste</p>';
        console.error(e);
      }
    }

    // Function to load patient data: fetches patient information from the API Gateway and displays it in the UI, handling errors gracefully.
    async function loadPatient(patientId) {
      const patientDiv = document.getElementById('patient');
      const listDiv = document.getElementById('patient-list');
      listDiv.style.display = 'none';
      patientDiv.style.display = 'block';
      patientDiv.innerHTML = '<div class="loading"><div class="spinner"></div><p style="margin-left: 10px;">Lade Patientendaten...</p></div>';
      try {
        const res = await fetch(`${API_BASE}/patients/${patientId}`);
        if (!res.ok) {
          patientDiv.innerHTML = '<p>Der Patient existiert nicht. Stellen Sie sicher, dass Sie /push-json-data im HIS Adapter gedrückt haben.</p>';
          return;
        }
        const p = await res.json();
        let html = `<h2>${p.name} — ${p.dob}</h2>`;
        html += `<h3>Diagnosen</h3><ul>` + (p.diagnoses || []).map(d => `<li>${d}</li>`).join('') + `</ul>`;
        html += `<h3>Empfehlungen</h3><ul>` + (p.recommendations || []).map(r => `<li>${r.text}</li>`).join('') + `</ul>`;
        html += '<button onclick="backToList()" class="back-btn">Zurück zur Liste</button>';
        patientDiv.innerHTML = html;
      } catch (e) {
        patientDiv.innerHTML = '<p>Fehler beim Laden der Patientendaten</p>';
        console.error(e);
      }
    }

    // Function to go back to patient list.
    function backToList() {
      document.getElementById('patient-list').style.display = 'block';
      document.getElementById('patient').style.display = 'none';
    }

    loadPatientList();
  </script>
</body>
</html>
